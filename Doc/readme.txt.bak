/*======================================================Project description================================================================*/

Function brief :
    The project uses STM32F411-DISCO suite as the device side,
    (1) ADC peripherals were used to collect the voltage value of the four-channel SEMG sensor at a frequency of 2000Hz, 
        and serial port peripherals were used to receive the six-axis gyroscope motion data at a frequency of 20Hz;
    (2) The serial port is used to send data to the upper computer, and the upper computer is used for frequency domain analysis and real-time waveform display;
    (3) Do time domain analysis on the embedded device and output the data to the UI screen of the serial port through GPIO analog serial port;

/*=============================================================code layers=================================================================*/

1. Folder organization :
    (1) Haedware folder - Direct operation of peripheral and kernel
    (2) Function folder - encapsulates peripheral and kernel operations with adjustable parameters, including peripheral Function files
    (3) Task folder - Functions and variables associated with RTOS tasks
    (4) Common folder - Files Common to the project, such as data structures
    (5) Doc folder -- Documentation

2. code layer:
    It is divided into Hardware abstraction layer, hardware driver layer, function module layer and task layer
    (1) Hardware abstraction layer: HAL library, which mainly includes encapsulation functions for register operation, 
        provided by ST official website and generated by CubeMX
    (2) Hardware driver layer: Mainly includes functions that interact with external hardware through various peripherals
    (3) Function module layer: use a series of hardware driver layer encapsulated functions to complete specific functions
    (4) Task layer: Specific task function in RTOS

/*===================================================Development Environment Description===================================================*/

1. Development Board:
    STM32F411_Discovery - MB1115D
2. CPU internal resources :
    (1)  CPU model: STM32F411VET6 / LQFP100 / ARM 32-bit Cortex-M4 (floating point unit with FPU hardware)
    (2)  Main frequency: 100 MHz, 125 DMIPS/1.25 DMIPS/MHz
    (3)  Internal Flash capacity: 512 K
    (4)  Internal SRAM capacity: 128 K SRAM
    (5)  1¡Á12-bit, 2.4 MSPS A/D converter: up to 16 channels
    (6)  General-purpose DMA: 16-stream DMA controllers with FIFOs and burst support
    (7)  Up to 11 timers: up to six 16-bit, two 32-bit timers up to 100 MHz, 
         each with up to four IC/OC/PWM or pulse counter and quadrature (incremental) encoder input, 
         two watchdog timers (independent and window) and 
         a SysTick timer
    (8)  Up to 81 I/O ports with interrupt capability
    (9)  Up to 3 x I2C interfaces (SMBus/PMBus)
    (10) Up to 3 USARTs (2 x 12.5 Mbit/s, 1 x 6.25 Mbit/s), ISO 7816 interface, LIN, IrDA, modem control)
    (11) Up to 5 SPI/I2Ss
    (12) SDIO interface (SD/MMC/eMMC)
    (13) Advanced connectivity: USB 2.0 full-speed device/host/OTG controller with on-chip -PHY
 
3. Memory space allocation:
    IROM1 : START - 0x8000000   SIZE - 0x80000
    IRAM1 : START - 0x20000000  SIZE - 0x20000
    STACK SIZE : 0x0000 0800
    HEAP  SIZE : 0x0000 0200

4. Software Development Related:
    (1) IDE : MDK 5.35 STM32CubeMX 6.6.1
    (2) Firmware Package Name and Version : STM32Cube FW_F4 V1.25.2
        X-CUBE_ALGOBUILD : DSP Library V1.3.0
    (3) Compiler : AC5 / --gnu / C99mode / USE Micro Lib
    (4) Common macro definition : 
        USE_HAL_DRIVER,STM32F411xE,ARM_MATH_CM4,ARM_MATH_MATRIX_CHECK,ARM_MATH_ROUNDING,__CC_ARM

5. Debug Settings : ST-LINK/V2
    (1) SWD  Req:10 MHz Selected: 1.800 MHz
    (2) Connect & Reset Options : Connect -  Normal , Reset - Autodetect
    (3) Cache Options : Cache Code / Cache Memory
    (4) Trace Options : 
        Core Clock: 100.000000 MHz
        Trace Enable
        Use Core Clock
        ITM Stimulus Ports : Enable: OxFFFFFFFF / Privilege: 0x00000008
    (5) Flash Download :
        Erase Sectors / Program / Verify
        RAM for Algorithm : Start - 0x20000000  Size - 0x00001000
        STM32F4xx 512kB Flash - 08000000H - 0807FFFFH
        Pack :  Keil.STM32F4xx DFP.2.15.0

/*=====================================================GPIO pin use with peripherals=======================================================*/

1. Clock source input and output :
    (1) PC14-OSC32_IN    RCC_OSC32_IN
    (2) PC15-OSC32_OUT   RCC_OSC32_OUT
    (3) PH0 - OSC_IN     RCC_OSC_IN
    (4) PH1 - OSC_OUT    RCC_OSC_OUT

2. LED:
    (1) PD12-LD4 [Green Led]
    (2) PD13-LD3 [Orange Led]
    (3) PD14-LD5 [Red Led]
    (4) PD15-LD6 [Blue Led]

3. ADC1:
    (1) PA1-ADC1_IN1
    (2) PA3-ADC1_IN3
    (3) PA5-ADC1_IN5
    (4) PA6-ADC1_IN6
    (5) Vref

4. USART:
    (1) USART6 : PC6-USART6_TX  PC7-USART6_RX
    (2) USART1 : PA9-USART1_TX  PA10-USART1_RX
    (3) USART2 : PA2-USART2_TX  PD6-USART2_RX

5. SWD:
    (1) PA13-SYS_JTMS-SWDIO
    (2) PA14-SYS_JTCK-SWCLK

6. GPIO:
    (1) PB0-RUNTIME_TEST_GPIO

/*===============================================================Key points================================================================*/

1. Why display "unknown signals" on the Display of Filling Signals in Logic Analyzer during MDK Debugging?
    WARNING :The M4-core microcontroller does not support the logic analyzer of MDK
    
2. Note that ADC should have a calibration function before turning on the ADC, but the STM32-F4 chip does not support ADC calibration

3. STM32F4 ADC Problem 1: only one conversion in ADC-DMA scan mode
    Note the problem of only one conversion in ADC scan mode, which is a common problem of STM32F4 series. For solutions, please refer to:
    https://www.cnblogs.com/SpaceVision/p/14967055.html
    
4. STM32F4 ADC Probelm 2: ADC measurement is inaccurate and the jump value is large
    Note that in this case, because the VDDA value is unknown, the ADC channel sample value must be calibrated using an internal reference voltage,
    please refer to:
    If VDDA is connected to VDD, the fluctuation of power supply will greatly affect the accuracy of ADC
    https://blog.csdn.net/weixin_43128823/article/details/82803927

5. Note that the development board that can be selected in CubeMX is STM32F411_Discovery-MB1115A. Different from the development board used in this project, 
   the clock source cannot be external clock, but internal high speed clock source (HSI) should be selected.
